<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* ------------------------------ */
    /* 1. å¤‰æ•°å®šç¾© (ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ)        */
    /* ------------------------------ */
    :root {
      --bg-main: #1d232a; /* ãƒ¡ã‚¤ãƒ³èƒŒæ™¯ (æš—ã„) */
      --bg-secondary: #2a323c; /* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèƒŒæ™¯ (å°‘ã—æ˜ã‚‹ã„) */
      --bg-input: #191e24; /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢èƒŒæ™¯ */
      
      --text-main: #e2e8f0; /* ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ */
      --text-muted: #718096; /* è£œåŠ©ãƒ†ã‚­ã‚¹ãƒˆ (ã‚ˆã‚Šæš—ãã—ã¦åŠé€æ˜æ„Ÿã‚’å¼·èª¿) */
      
      --accent-color: #0091A9; /* æŒ‡å®šã•ã‚ŒãŸã‚­ãƒ¼ã‚«ãƒ©ãƒ¼ */
      --accent-hover: #00a9c6; /* ã‚­ãƒ¼ã‚«ãƒ©ãƒ¼ã®ãƒ›ãƒãƒ¼è‰² */
      
      --border-color: #4a5568; /* å¢ƒç•Œç·š */
      --focus-shadow: rgba(0, 145, 169, 0.5); /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®å½± */
      
      --error-color: #f87171; /* ã‚¨ãƒ©ãƒ¼ */
      --success-color: #4ade80; /* æˆåŠŸ */
    }

    /* ------------------------------ */
    /* 2. åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«                  */
    /* ------------------------------ */
    body {
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-main);
      color: var(--text-main);
      line-height: 1.6;
      margin: 0;
    }

    /* â–¼ åç§°å¤‰æ›´ â–¼ */
    h3 {
      font-size: 1.5em;
      font-weight: 300;
      color: var(--text-main);
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 8px;
      margin-top: 0;
    }
    
    h3 strong {
        color: var(--accent-color);
        font-weight: 600;
    }
    /* â–² åç§°å¤‰æ›´ â–² */

    h4 {
      font-size: 1.1em;
      color: var(--text-muted);
      margin-top: 24px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    p {
      color: var(--text-muted);
      font-size: 0.95em;
    }
    
    a {
      color: var(--accent-color);
      text-decoration: none;
      transition: color 0.2s;
    }
    a:hover {
      color: var(--accent-hover);
      text-decoration: underline;
    }
    
    /* ------------------------------ */
    /* 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ              */
    /* ------------------------------ */
    
    /* â–¼ ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ â–¼ */
    #prompt-area {
      width: 100%;
      height: 300px; 
      margin-bottom: 16px;
      box-sizing: border-box; 
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      background-color: var(--bg-input);
      
      /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–‡å­—è‰²ã‚’ã€ŒåŠé€æ˜ã€ã«è¦‹ãˆã‚‹ã‚ˆã†--text-mutedã«å¤‰æ›´ */
      color: var(--text-muted);
      
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 12px;
      font-size: 0.9em;
      /* colorã®åˆ‡ã‚Šæ›¿ãˆã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ */
      transition: border-color 0.2s, box-shadow 0.2s, color 0.2s; 
    }
    
    /* * JSã§ 'has-input' ã‚¯ãƒ©ã‚¹ãŒä»˜ä¸ã•ã‚ŒãŸã‚‰ (ï¼å…¥åŠ›ä¸­ã«ãªã£ãŸã‚‰)
     * æ–‡å­—è‰²ã‚’é€šå¸¸è‰² (--text-main) ã«æˆ»ã™
     */
    #prompt-area.has-input {
        color: var(--text-main);
    }
    
    #prompt-area:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px var(--focus-shadow);
      /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå½“ãŸã£ãŸæ™‚ã‚‚æ–‡å­—è‰²ã‚’å³åº§ã«é€šå¸¸è‰²ã«æˆ»ã™ */
      color: var(--text-main); 
    }
    /* â–² ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ â–² */


    /* é€ä¿¡ãƒœã‚¿ãƒ³ (ãƒ—ãƒ©ã‚¤ãƒãƒª) */
    #submit-button {
      background-color: var(--accent-color);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, transform 0.1s ease;
      width: 100%; 
      box-sizing: border-box;
    }
    
    #submit-button:hover:not(:disabled) {
      background-color: var(--accent-hover);
      transform: translateY(-1px);
    }
    
    #submit-button:disabled {
      background-color: var(--border-color);
      color: var(--text-muted);
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    /* è£œåŠ©ãƒœã‚¿ãƒ³ (Gemãƒªãƒ³ã‚¯ç”¨) */
    .secondary-button {
      display: inline-block;
      background-color: transparent;
      color: var(--accent-color);
      border: 1px solid var(--accent-color);
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none; 
      transition: background-color 0.2s ease, color 0.2s ease;
      margin-bottom: 16px; 
    }
    
    .secondary-button:hover {
      background-color: var(--focus-shadow); 
      color: var(--text-main);
      text-decoration: none;
    }

    /* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
    #result {
      margin-top: 16px;
      padding: 16px;
      border: 1px dashed var(--border-color);
      background-color: var(--bg-secondary);
      min-height: 50px;
      word-wrap: break-word;
      border-radius: 8px;
      color: var(--text-muted);
    }
    
    #result b {
        color: var(--text-main);
    }

    /* çŠ¶æ…‹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
    .loading-icon, .success-icon, .error-icon {
        font-weight: bold;
        font-size: 1.2em;
        margin-right: 8px;
    }
    .loading-icon { color: var(--text-muted); }
    .success-icon { color: var(--success-color); }
    .error-icon { color: var(--error-color); }

    .error {
      color: var(--error-color);
      font-weight: bold;
    }
  </style>
  </head>
<body>
  
  <h3>Gãƒ•ã‚©ãƒ¼ãƒ å¼ç¥ <strong>v1</strong></h3>
  <p>ãƒ•ã‚©ãƒ¼ãƒ ã®ã€Œè¨­è¨ˆå›³ (JSON)ã€ã‚’ä»¥ä¸‹ã«è²¼ã‚Šä»˜ã‘ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>

    <!--  ---------------------------------------------
     â–¼â–¼â–¼è¨­å®šç®‡æ‰€â–¼â–¼â–¼*/
      ---------------------------------------------
     ã‚ãªãŸå°‚ç”¨ã®ã€ŒGemãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæŒ‡ç¤ºæ›¸ï¼‰ã€ã®å…±æœ‰ãƒªãƒ³ã‚¯ã‚’
     ä»¥ä¸‹ã®ã€ŒYOUR_GEMINI_PROMPT_SHARE_LINK_HEREã€ã®éƒ¨åˆ†ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚
      (ä¾‹: "https://gemini.google.com/gem/xxxxxxxx?usp=sharing")-->

  <a href="YOUR_GEMINI_PROMPT_SHARE_LINK_HERE" target="_blank" rel="noopener noreferrer" class="secondary-button">
    ğŸ“ Gemãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç·¨é›†/ã‚³ãƒ”ãƒ¼
  </a>

  <textarea id="prompt-area">{
  "title": "ï¼ˆã“ã“ã«JSONã‚’è²¼ã‚Šä»˜ã‘ï¼‰",
  "description": "ãƒ†ã‚¹ãƒˆç”¨ã®JSONã‚’ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
  "items": [
    {
      "type": "text",
      "title": "ãŠåå‰",
      "required": true
    }
  ]
}
  </textarea>
  
  <button id="submit-button" onclick="submitFormRequest()">
    ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰
  </button>
  
  <h4>å®Ÿè¡Œçµæœ</h4>
  <div id="result">
    ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
  </div>

  <script>
    const submitButton = document.getElementById('submit-button');
    const resultDiv = document.getElementById('result');
    
    // --- â–¼ ã“ã“ã‹ã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ  â–¼ ---
    const promptArea = document.getElementById('prompt-area');
    // 'isPristine' ã¯ã€Œã¾ã ä¸€åº¦ã‚‚è§¦ã‚‰ã‚Œã¦ã„ãªã„ã€çŠ¶æ…‹ã‚’ç¤ºã™ãƒ•ãƒ©ã‚°
    let isPristine = true; 

    // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå½“ãŸã£ãŸæ™‚ã®å‡¦ç†
    promptArea.onfocus = function() {
      // ã‚‚ã—ã€ã¾ã ä¸€åº¦ã‚‚è§¦ã‚‰ã‚Œã¦ã„ãªã‘ã‚Œã°
      if (isPristine) {
        promptArea.value = ''; // ä¸­èº«ã‚’ç©ºã«ã™ã‚‹
        promptArea.classList.add('has-input'); // CSSã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦æ–‡å­—è‰²ã‚’æ¿ƒãã™ã‚‹
        isPristine = false; // ã€Œè§¦ã‚‰ã‚ŒãŸã€çŠ¶æ…‹ã«å¤‰æ›´
      }
    };
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½•ã‹å…¥åŠ›ã—ãŸæ™‚ã®å‡¦ç†
    promptArea.oninput = function() {
      // æ‰‹å‹•ã§å…¥åŠ›ï¼ˆã¾ãŸã¯ãƒšãƒ¼ã‚¹ãƒˆï¼‰ã•ã‚ŒãŸå ´åˆã‚‚ã€Œè§¦ã‚‰ã‚ŒãŸã€çŠ¶æ…‹ã«ã™ã‚‹
      if (isPristine) {
        isPristine = false;
        promptArea.classList.add('has-input');
      }
    };
    // --- â–² ã“ã“ã¾ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ  â–² ---


    // 1. ã€Œä½œæˆã™ã‚‹ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
    function submitFormRequest() {
      const promptText = document.getElementById('prompt-area').value;

      // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      submitButton.disabled = true;
      submitButton.innerText = "æ§‹ç¯‰ä¸­...";
      resultDiv.innerHTML = '<span class="loading-icon">â³</span>JSONã‚’è§£æã—ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰ä¸­ã§ã™...';

      // GASã®ã‚µãƒ¼ãƒãƒ¼å´é–¢æ•° `processUserInput` ã‚’å‘¼ã³å‡ºã™
      google.script.run
        .withSuccessHandler(onSuccess) // GASSå´ã§ã®æˆåŠŸæ™‚ã®å‡¦ç†
        .withFailureHandler(onFailure) // å¤±æ•—æ™‚ã®å‡¦ç†
        .processUserInput(promptText); // æ¸¡ã™ãƒ‡ãƒ¼ã‚¿
    }

    // 2. GASSå´ã§ã®æˆåŠŸæ™‚ã®å‡¦ç†
    function onSuccess(resultString) {
      // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
      submitButton.disabled = false;
      submitButton.innerText = "ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰";
      
      try {
        const result = JSON.parse(resultString);
        
        if (result.status === 'success') {
          // æˆåŠŸã—ãŸå ´åˆã€ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
          resultDiv.innerHTML = 
            '<span class="success-icon">âœ”</span> <strong>ãƒ•ã‚©ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼</strong><br><br>' +
            '<b>å›ç­”ç”¨URL:</b> <a href="' + result.publishedUrl + '" target="_blank" rel="noopener noreferrer">' + result.publishedUrl + '</a><br>' +
            '<b>ç·¨é›†ç”¨URL:</b> <a href="' + result.editUrl + '" target="_blank" rel="noopener noreferrer">' + result.editUrl + '</a>';
        } else {
          // GASå´ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸå ´åˆ
          onFailure(new Error(result.message));
        }
      } catch (e) {
        // JSONã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆ
        onFailure(e);
      }
    }

    // 3. å¤±æ•—æ™‚ã®å‡¦ç†
    function onFailure(error) {
      // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
      submitButton.disabled = false;
      submitButton.innerText = "ãƒ•ã‚©ãƒ¼ãƒ ã‚’æ§‹ç¯‰";
      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      resultDiv.innerHTML = '<span class="error-icon">âœ–</span> <span class="error">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message + '</span>';
    }
  </script>
  </body>
</html>
